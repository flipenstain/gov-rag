{
    "target_table": "wh_db.DimAccount",
    "sources_summary": {
        "wh_db_stage.CustomerMgmt": [
            "accountid",
            "customerid",
            "accountdesc",
            "taxstatus",
            "brokerid",
            "status",
            "update_ts"
        ],
        "wh_db.DimCustomer": [
            "sk_customerid",
            "customerid",
            "effectivedate",
            "enddate"
        ],
        "wh_db.DimBroker": [
            "sk_brokerid",
            "brokerid"
        ]
    },
    "lineage": {
        "sk_accountid": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "strftime(a.effectivedate, '%Y%m%d') || a.accountid",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "accountid",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "accountid"
                },
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "update_ts",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "effectivedate",
                    "role": "date_part"
                }
            ]
        },
        "accountid": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "accountid",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "accountid",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "accountid"
                }
            ]
        },
        "sk_brokerid": {
            "path": [
                "b"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "sk_brokerid",
            "sources": [
                {
                    "table": "wh_db.DimBroker",
                    "column": "sk_brokerid",
                    "path": [
                        "b"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "sk_brokerid"
                }
            ]
        },
        "sk_customerid": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "sk_customerid",
            "sources": [
                {
                    "table": "wh_db.DimCustomer",
                    "column": "sk_customerid",
                    "path": [
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "sk_customerid"
                }
            ]
        },
        "accountdesc": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "accountdesc",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "accountdesc",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "WINDOW_FUNCTION",
                    "transformation_logic": "COALESCE(accountdesc, last_value(accountdesc) OVER w)",
                    "role": "value"
                }
            ]
        },
        "taxstatus": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "TaxStatus",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "taxstatus",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "WINDOW_FUNCTION",
                    "transformation_logic": "COALESCE(taxstatus, last_value(taxstatus) OVER w)",
                    "role": "value"
                }
            ]
        },
        "status": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "status",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "status",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "WINDOW_FUNCTION",
                    "transformation_logic": "COALESCE(status, last_value(status) OVER w)",
                    "role": "value"
                }
            ]
        },
        "iscurrent": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "SCD2_LOGIC",
            "transformation_logic": "CASE WHEN a.enddate = '9999-12-31'::DATE THEN true ELSE false END",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "update_ts",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "WINDOW_FUNCTION",
                    "transformation_logic": "CASE WHEN lead(update_ts) OVER w IS NULL THEN 'Y' ELSE 'N' END",
                    "role": "condition_input"
                }
            ]
        },
        "batchid": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "batchid",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "update_ts",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "CONSTANT",
                    "transformation_logic": "1"
                }
            ]
        },
        "effectivedate": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "effectivedate",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "update_ts",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "effectivedate"
                },
                {
                    "table": "wh_db.DimCustomer",
                    "column": "effectivedate",
                    "path": [
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "effectivedate"
                }
            ]
        },
        "enddate": {
            "path": [
                "account_cust_updates",
                "a"
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "enddate",
            "sources": [
                {
                    "table": "wh_db_stage.CustomerMgmt",
                    "column": "update_ts",
                    "path": [
                        "account",
                        "a",
                        "account_final",
                        "a",
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "WINDOW_FUNCTION",
                    "transformation_logic": "COALESCE(lead(update_ts::DATE) OVER w, '9999-12-31'::DATE)",
                    "role": "value"
                },
                {
                    "table": "wh_db.DimCustomer",
                    "column": "enddate",
                    "path": [
                        "account_cust_updates",
                        "a"
                    ],
                    "transformation_type": "RENAME",
                    "transformation_logic": "enddate"
                }
            ]
        }
    }
}