{
    "target_table": "wh_db.DimTrade",
    "sources_summary": [
        {
            "type": "TABLE",
            "name": "wh_db_stage.tradetxt",
            "alias_or_cte": "tradehistorical"
        },
        {
            "type": "TABLE",
            "name": "wh_db_stage.tradehistory",
            "alias_or_cte": "tradehistorical"
        },
        {
            "type": "TABLE",
            "name": "wh_db.StatusType",
            "alias_or_cte": "tradehistorical"
        },
        {
            "type": "TABLE",
            "name": "wh_db.DimSecurity",
            "alias_or_cte": "ds"
        },
        {
            "type": "TABLE",
            "name": "wh_db.DimAccount",
            "alias_or_cte": "da"
        }
    ],
    "lineage": {
        "tradeid": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.tradeid",
                    "path": [
                        "tradehistorical.tradeid",
                        "trade.tradeid"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.tradeid"
        },
        "sk_brokerid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimAccount.sk_brokerid",
                    "path": [
                        "da.sk_brokerid"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "da.sk_brokerid via JOIN ON trade.t_ca_id = da.accountid AND SK_CreateDateID::DATE >= da.effectivedate AND SK_CreateDateID::DATE < da.enddate"
        },
        "CAST(strftime(trade.SK_CreateDateID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradehistory.TH_DTS",
                    "path": [
                        "tradehistorical.SK_CreateDateID",
                        "trade.SK_CreateDateID"
                    ],
                    "role": "Date part source"
                },
                {
                    "source_identifier": "wh_db_stage.tradetxt.t_ca_id",
                    "path": [
                        "tradehistorical.t_ca_id",
                        "trade.t_ca_id",
                        "da.accountid"
                    ],
                    "role": "ID part source 1"
                },
                {
                    "source_identifier": "wh_db.DimAccount.sk_brokerid",
                    "path": [
                        "da.sk_brokerid"
                    ],
                    "role": "ID part source 2"
                }
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "CAST(strftime(trade.SK_CreateDateID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)"
        },
        "CAST(strftime(trade.SK_CreateTimeID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradehistory.TH_DTS",
                    "path": [
                        "tradehistorical.SK_CreateTimeID",
                        "trade.SK_CreateTimeID"
                    ],
                    "role": "Date part source"
                },
                {
                    "source_identifier": "wh_db_stage.tradetxt.t_ca_id",
                    "path": [
                        "tradehistorical.t_ca_id",
                        "trade.t_ca_id",
                        "da.accountid"
                    ],
                    "role": "ID part source 1"
                },
                {
                    "source_identifier": "wh_db.DimAccount.sk_brokerid",
                    "path": [
                        "da.sk_brokerid"
                    ],
                    "role": "ID part source 2"
                }
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "CAST(strftime(trade.SK_CreateTimeID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)"
        },
        "CAST(strftime(trade.SK_CloseDateID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradehistory.TH_DTS",
                    "path": [
                        "tradehistorical.SK_CloseDateID",
                        "trade.SK_CloseDateID"
                    ],
                    "role": "Date part source"
                },
                {
                    "source_identifier": "wh_db_stage.tradetxt.t_ca_id",
                    "path": [
                        "tradehistorical.t_ca_id",
                        "trade.t_ca_id",
                        "da.accountid"
                    ],
                    "role": "ID part source 1"
                },
                {
                    "source_identifier": "wh_db.DimAccount.sk_brokerid",
                    "path": [
                        "da.sk_brokerid"
                    ],
                    "role": "ID part source 2"
                }
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "CAST(strftime(trade.SK_CloseDateID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)"
        },
        "CAST(strftime(trade.SK_CloseTimeID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradehistory.TH_DTS",
                    "path": [
                        "tradehistorical.SK_CloseTimeID",
                        "trade.SK_CloseTimeID"
                    ],
                    "role": "Date part source"
                },
                {
                    "source_identifier": "wh_db_stage.tradetxt.t_ca_id",
                    "path": [
                        "tradehistorical.t_ca_id",
                        "trade.t_ca_id",
                        "da.accountid"
                    ],
                    "role": "ID part source 1"
                },
                {
                    "source_identifier": "wh_db.DimAccount.sk_brokerid",
                    "path": [
                        "da.sk_brokerid"
                    ],
                    "role": "ID part source 2"
                }
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "CAST(strftime(trade.SK_CloseTimeID, '%Y%m%d') || da.accountid || da.sk_brokerid AS BIGINT)"
        },
        "st_name": {
            "sources": [
                {
                    "source_identifier": "wh_db.StatusType.st_name",
                    "path": [
                        "tradehistorical.st_name",
                        "trade.st_name"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "trade.st_name via JOIN ON a.status = c.st_id"
        },
        "type": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.t_tt_id",
                    "path": [
                        "tradehistorical.t_tt_id",
                        "trade.t_tt_id"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "CASE_MAPPING",
            "transformation_logic": "CASE t_tt_id WHEN 'TMB' THEN 'Market Buy' WHEN 'TMS' THEN 'Market Sell' WHEN 'TSL' THEN 'Stop Loss' WHEN 'TLS' THEN 'Limit Sell' WHEN 'TLB' THEN 'Limit Buy' ELSE NULL END"
        },
        "cashflag": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.cashflag",
                    "path": [
                        "tradehistorical.cashflag",
                        "trade.cashflag"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.cashflag"
        },
        "sk_securityid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimSecurity.sk_securityid",
                    "path": [
                        "ds.sk_securityid"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "ds.sk_securityid via JOIN ON ds.symbol = trade.t_s_symb AND SK_CreateDateID::DATE >= ds.effectivedate AND SK_CreateDateID::DATE < ds.enddate"
        },
        "sk_companyid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimSecurity.sk_companyid",
                    "path": [
                        "ds.sk_companyid"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "ds.sk_companyid via JOIN ON ds.symbol = trade.t_s_symb AND SK_CreateDateID::DATE >= ds.effectivedate AND SK_CreateDateID::DATE < ds.enddate"
        },
        "quantity": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.quantity",
                    "path": [
                        "tradehistorical.quantity",
                        "trade.quantity"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.quantity"
        },
        "bidprice": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.bidprice",
                    "path": [
                        "tradehistorical.bidprice",
                        "trade.bidprice"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.bidprice"
        },
        "sk_customerid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimAccount.sk_customerid",
                    "path": [
                        "da.sk_customerid"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "da.sk_customerid via JOIN ON trade.t_ca_id = da.accountid AND SK_CreateDateID::DATE >= da.effectivedate AND SK_CreateDateID::DATE < da.enddate"
        },
        "sk_accountid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimAccount.sk_accountid",
                    "path": [
                        "da.sk_accountid"
                    ],
                    "role": "Join lookup"
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "da.sk_accountid via JOIN ON trade.t_ca_id = da.accountid AND SK_CreateDateID::DATE >= da.effectivedate AND SK_CreateDateID::DATE < da.enddate"
        },
        "executedby": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.executedby",
                    "path": [
                        "tradehistorical.executedby",
                        "trade.executedby"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.executedby"
        },
        "tradeprice": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.tradeprice",
                    "path": [
                        "tradehistorical.tradeprice",
                        "trade.tradeprice"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.tradeprice"
        },
        "fee": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.fee",
                    "path": [
                        "tradehistorical.fee",
                        "trade.fee"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.fee"
        },
        "commission": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.commission",
                    "path": [
                        "tradehistorical.commission",
                        "trade.commission"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.commission"
        },
        "tax": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.tradetxt.tax",
                    "path": [
                        "tradehistorical.tax",
                        "trade.tax"
                    ],
                    "role": "Direct input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "trade.tax"
        },
        "batchid": {
            "sources": [
                {
                    "source_identifier": "CONSTANT",
                    "path": [
                        "trade.batchid"
                    ],
                    "role": "Constant value"
                }
            ],
            "transformation_type": "CONSTANT",
            "transformation_logic": "1"
        }
    }
}