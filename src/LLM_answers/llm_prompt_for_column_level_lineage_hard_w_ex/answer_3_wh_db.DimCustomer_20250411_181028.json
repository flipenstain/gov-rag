{
    "target_table": "wh_db.DimCustomer",
    "sources_summary": [
        {
            "type": "TABLE",
            "name": "customers_final",
            "alias_or_cte": "c"
        },
        {
            "type": "TABLE",
            "name": "wh_db.TaxRate",
            "alias_or_cte": "r_lcl"
        },
        {
            "type": "TABLE",
            "name": "wh_db.TaxRate",
            "alias_or_cte": "r_nat"
        },
        {
            "type": "TABLE",
            "name": "wh_db_stage.ProspectIncremental",
            "alias_or_cte": "p"
        },
        {
            "type": "TABLE",
            "name": "wh_db.DimCustomer",
            "alias_or_cte": "MaxSK"
        }
    ],
    "lineage": {
        "sk_customerid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimCustomer.sk_customerid",
                    "path": [
                        "MaxSK.max_sk_customerid"
                    ],
                    "role": "Max SK Value"
                }
            ],
            "transformation_type": "WINDOW_FUNCTION",
            "transformation_logic": "ROW_NUMBER() OVER () + (SELECT max_sk_customerid FROM MaxSK) + 1",
            "notes": "Incrementing surrogate key"
        },
        "customerid": {
            "sources": [
                {
                    "source_identifier": "customers_final.customerid",
                    "path": [
                        "CustomerData.customerid"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.customerid"
        },
        "taxid": {
            "sources": [
                {
                    "source_identifier": "customers_final.taxid",
                    "path": [
                        "CustomerData.taxid"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.taxid"
        },
        "status": {
            "sources": [
                {
                    "source_identifier": "customers_final.status",
                    "path": [
                        "CustomerData.status"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.status"
        },
        "lastname": {
            "sources": [
                {
                    "source_identifier": "customers_final.lastname",
                    "path": [
                        "CustomerData.lastname"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.lastname"
        },
        "firstname": {
            "sources": [
                {
                    "source_identifier": "customers_final.firstname",
                    "path": [
                        "CustomerData.firstname"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.firstname"
        },
        "middleinitial": {
            "sources": [
                {
                    "source_identifier": "customers_final.middleinitial",
                    "path": [
                        "CustomerData.middleinitial"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.middleinitial"
        },
        "gender": {
            "sources": [
                {
                    "source_identifier": "customers_final.gender",
                    "path": [
                        "CustomerData.gender"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "CASE_MAPPING",
            "transformation_logic": "IF(c.gender IN ('M', 'F'), c.gender, 'U')"
        },
        "tier": {
            "sources": [
                {
                    "source_identifier": "customers_final.tier",
                    "path": [
                        "CustomerData.tier"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.tier"
        },
        "dob": {
            "sources": [
                {
                    "source_identifier": "customers_final.dob",
                    "path": [
                        "CustomerData.dob"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.dob"
        },
        "addressline1": {
            "sources": [
                {
                    "source_identifier": "customers_final.addressline1",
                    "path": [
                        "CustomerData.addressline1"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.addressline1"
        },
        "addressline2": {
            "sources": [
                {
                    "source_identifier": "customers_final.addressline2",
                    "path": [
                        "CustomerData.addressline2"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.addressline2"
        },
        "postalcode": {
            "sources": [
                {
                    "source_identifier": "customers_final.postalcode",
                    "path": [
                        "CustomerData.postalcode"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.postalcode"
        },
        "city": {
            "sources": [
                {
                    "source_identifier": "customers_final.city",
                    "path": [
                        "CustomerData.city"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.city"
        },
        "stateprov": {
            "sources": [
                {
                    "source_identifier": "customers_final.stateprov",
                    "path": [
                        "CustomerData.stateprov"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.stateprov"
        },
        "country": {
            "sources": [
                {
                    "source_identifier": "customers_final.country",
                    "path": [
                        "CustomerData.country"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.country"
        },
        "phone1": {
            "sources": [
                {
                    "source_identifier": "customers_final.phone1",
                    "path": [
                        "CustomerData.phone1"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.phone1"
        },
        "phone2": {
            "sources": [
                {
                    "source_identifier": "customers_final.phone2",
                    "path": [
                        "CustomerData.phone2"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.phone2"
        },
        "phone3": {
            "sources": [
                {
                    "source_identifier": "customers_final.phone3",
                    "path": [
                        "CustomerData.phone3"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.phone3"
        },
        "email1": {
            "sources": [
                {
                    "source_identifier": "customers_final.email1",
                    "path": [
                        "CustomerData.email1"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.email1"
        },
        "email2": {
            "sources": [
                {
                    "source_identifier": "customers_final.email2",
                    "path": [
                        "CustomerData.email2"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.email2"
        },
        "nationaltaxratedesc": {
            "sources": [
                {
                    "source_identifier": "wh_db.TaxRate.TX_NAME",
                    "path": [
                        "CustomerData.nationaltaxratedesc"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "INNER JOIN",
                        "left_source": {
                            "identifier": "customers_final.nat_tx_id",
                            "path": [
                                "c.nat_tx_id"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db.TaxRate.TX_ID",
                            "path": [
                                "r_nat.TX_ID"
                            ]
                        }
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "r_nat.TX_NAME"
        },
        "nationaltaxrate": {
            "sources": [
                {
                    "source_identifier": "wh_db.TaxRate.TX_RATE",
                    "path": [
                        "CustomerData.nationaltaxrate"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "INNER JOIN",
                        "left_source": {
                            "identifier": "customers_final.nat_tx_id",
                            "path": [
                                "c.nat_tx_id"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db.TaxRate.TX_ID",
                            "path": [
                                "r_nat.TX_ID"
                            ]
                        }
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "r_nat.TX_RATE"
        },
        "localtaxratedesc": {
            "sources": [
                {
                    "source_identifier": "wh_db.TaxRate.TX_NAME",
                    "path": [
                        "CustomerData.localtaxratedesc"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "INNER JOIN",
                        "left_source": {
                            "identifier": "customers_final.lcl_tx_id",
                            "path": [
                                "c.lcl_tx_id"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db.TaxRate.TX_ID",
                            "path": [
                                "r_lcl.TX_ID"
                            ]
                        }
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "r_lcl.TX_NAME"
        },
        "localtaxrate": {
            "sources": [
                {
                    "source_identifier": "wh_db.TaxRate.TX_RATE",
                    "path": [
                        "CustomerData.localtaxrate"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "INNER JOIN",
                        "left_source": {
                            "identifier": "customers_final.lcl_tx_id",
                            "path": [
                                "c.lcl_tx_id"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db.TaxRate.TX_ID",
                            "path": [
                                "r_lcl.TX_ID"
                            ]
                        }
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "r_lcl.TX_RATE"
        },
        "agencyid": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.ProspectIncremental.agencyid",
                    "path": [
                        "CustomerData.agencyid"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "LEFT JOIN",
                        "left_source": {
                            "identifier": "customers_final.lastname",
                            "path": [
                                "c.lastname"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db_stage.ProspectIncremental.lastname",
                            "path": [
                                "p.lastname"
                            ]
                        },
                        "join_condition": "UPPER(p.lastname) = UPPER(c.lastname) AND UPPER(p.firstname) = UPPER(c.firstname) AND UPPER(p.addressline1) = UPPER(c.addressline1) AND UPPER(NULLIF(p.addressline2, '')) = UPPER(NULLIF(c.addressline2, '')) AND UPPER(p.postalcode) = UPPER(c.postalcode)"
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "p.agencyid"
        },
        "creditrating": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.ProspectIncremental.creditrating",
                    "path": [
                        "CustomerData.creditrating"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "LEFT JOIN",
                        "left_source": {
                            "identifier": "customers_final.lastname",
                            "path": [
                                "c.lastname"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db_stage.ProspectIncremental.lastname",
                            "path": [
                                "p.lastname"
                            ]
                        },
                        "join_condition": "UPPER(p.lastname) = UPPER(c.lastname) AND UPPER(p.firstname) = UPPER(c.firstname) AND UPPER(p.addressline1) = UPPER(c.addressline1) AND UPPER(NULLIF(p.addressline2, '')) = UPPER(NULLIF(c.addressline2, '')) AND UPPER(p.postalcode) = UPPER(c.postalcode)"
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "p.creditrating"
        },
        "networth": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.ProspectIncremental.networth",
                    "path": [
                        "CustomerData.networth"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "LEFT JOIN",
                        "left_source": {
                            "identifier": "customers_final.lastname",
                            "path": [
                                "c.lastname"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db_stage.ProspectIncremental.lastname",
                            "path": [
                                "p.lastname"
                            ]
                        },
                        "join_condition": "UPPER(p.lastname) = UPPER(c.lastname) AND UPPER(p.firstname) = UPPER(c.firstname) AND UPPER(p.addressline1) = UPPER(c.addressline1) AND UPPER(NULLIF(p.addressline2, '')) = UPPER(NULLIF(c.addressline2, '')) AND UPPER(p.postalcode) = UPPER(c.postalcode)"
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "p.networth"
        },
        "marketingnameplate": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.ProspectIncremental.marketingnameplate",
                    "path": [
                        "CustomerData.marketingnameplate"
                    ],
                    "role": "Direct Input",
                    "join_info": {
                        "type": "LEFT JOIN",
                        "left_source": {
                            "identifier": "customers_final.lastname",
                            "path": [
                                "c.lastname"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db_stage.ProspectIncremental.lastname",
                            "path": [
                                "p.lastname"
                            ]
                        },
                        "join_condition": "UPPER(p.lastname) = UPPER(c.lastname) AND UPPER(p.firstname) = UPPER(c.firstname) AND UPPER(p.addressline1) = UPPER(c.addressline1) AND UPPER(NULLIF(p.addressline2, '')) = UPPER(NULLIF(c.addressline2, '')) AND UPPER(p.postalcode) = UPPER(c.postalcode)"
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "p.marketingnameplate"
        },
        "iscurrent": {
            "sources": [
                {
                    "source_identifier": "customers_final.iscurrent",
                    "path": [
                        "CustomerData.iscurrent"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.iscurrent"
        },
        "batchid": {
            "sources": [
                {
                    "source_identifier": "customers_final.batchid",
                    "path": [
                        "CustomerData.batchid"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.batchid"
        },
        "effectivedate": {
            "sources": [
                {
                    "source_identifier": "customers_final.effectivedate",
                    "path": [
                        "CustomerData.effectivedate"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.effectivedate"
        },
        "enddate": {
            "sources": [
                {
                    "source_identifier": "customers_final.enddate",
                    "path": [
                        "CustomerData.enddate"
                    ],
                    "role": "Direct Input"
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "c.enddate"
        }
    }
}