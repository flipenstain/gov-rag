{
    "target_table": "wh_db.DimAccount",
    "sources_summary": [
        {
            "type": "TABLE",
            "name": "wh_db_stage.CustomerMgmt",
            "alias_or_cte": "account"
        },
        {
            "type": "TABLE",
            "name": "wh_db.DimCustomer",
            "alias_or_cte": "c"
        },
        {
            "type": "TABLE",
            "name": "wh_db.DimBroker",
            "alias_or_cte": "b"
        }
    ],
    "lineage": {
        "CAST(strftime(a.effectivedate, '%Y%m%d') || a.accountid AS BIGINT)": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.update_ts",
                    "path": [
                        "account.update_ts",
                        "account_final.update_ts",
                        "account_cust_updates.effectivedate",
                        "a.effectivedate"
                    ],
                    "role": "Date part source"
                },
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.accountid",
                    "path": [
                        "account.accountid",
                        "account_final.accountid",
                        "account_cust_updates.accountid",
                        "a.accountid"
                    ],
                    "role": "ID part source"
                }
            ],
            "transformation_type": "EXPRESSION_CONCAT",
            "transformation_logic": "CAST(strftime(a.effectivedate, '%Y%m%d') || a.accountid AS BIGINT)"
        },
        "accountid": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.accountid",
                    "path": [
                        "account.accountid",
                        "account_final.accountid",
                        "account_cust_updates.accountid",
                        "a.accountid"
                    ]
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "a.accountid"
        },
        "sk_brokerid": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.brokerid",
                    "path": [
                        "account.brokerid",
                        "account_final.brokerid",
                        "account_cust_updates.brokerid",
                        "a.brokerid"
                    ],
                    "join_info": {
                        "type": "INNER JOIN",
                        "left_source": {
                            "identifier": "wh_db_stage.CustomerMgmt.brokerid",
                            "path": [
                                "account.brokerid",
                                "account_final.brokerid",
                                "account_cust_updates.brokerid",
                                "a.brokerid"
                            ]
                        },
                        "right_source": {
                            "identifier": "wh_db.DimBroker.brokerid"
                        }
                    }
                }
            ],
            "transformation_type": "JOIN_LOOKUP",
            "transformation_logic": "b.sk_brokerid via JOIN ON a.brokerid = b.brokerid"
        },
        "sk_customerid": {
            "sources": [
                {
                    "source_identifier": "wh_db.DimCustomer.sk_customerid",
                    "path": [
                        "account_cust_updates.sk_customerid",
                        "a.sk_customerid"
                    ]
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "a.sk_customerid"
        },
        "accountdesc": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.accountdesc",
                    "path": [
                        "account.accountdesc",
                        "account_final.accountdesc",
                        "account_cust_updates.accountdesc",
                        "a.accountdesc"
                    ]
                }
            ],
            "transformation_type": "WINDOW_FUNCTION",
            "transformation_logic": "COALESCE(accountdesc, last_value(accountdesc) OVER w)",
            "notes": "Imputation using last_value window function"
        },
        "TaxStatus": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.taxstatus",
                    "path": [
                        "account.taxstatus",
                        "account_final.taxstatus",
                        "account_cust_updates.TaxStatus",
                        "a.TaxStatus"
                    ]
                }
            ],
            "transformation_type": "WINDOW_FUNCTION",
            "transformation_logic": "COALESCE(taxstatus, last_value(taxstatus) OVER w)",
            "notes": "Imputation using last_value window function"
        },
        "status": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.status",
                    "path": [
                        "account.status",
                        "account_final.status",
                        "account_cust_updates.status",
                        "a.status"
                    ]
                }
            ],
            "transformation_type": "WINDOW_FUNCTION",
            "transformation_logic": "COALESCE(status, last_value(status) OVER w)",
            "notes": "Imputation using last_value window function"
        },
        "iscurrent": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.update_ts",
                    "path": [
                        "account.update_ts",
                        "account_final.update_ts",
                        "account_cust_updates.enddate",
                        "a.enddate"
                    ]
                }
            ],
            "transformation_type": "CASE_MAPPING",
            "transformation_logic": "CASE WHEN a.enddate = '9999-12-31'::DATE THEN true ELSE false END"
        },
        "batchid": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.batchid",
                    "path": [
                        "account.batchid",
                        "account_final.batchid",
                        "account_cust_updates.batchid",
                        "a.batchid"
                    ]
                }
            ],
            "transformation_type": "RENAME",
            "transformation_logic": "a.batchid"
        },
        "effectivedate": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.update_ts",
                    "path": [
                        "account.update_ts",
                        "account_final.effectivedate",
                        "account_cust_updates.effectivedate",
                        "a.effectivedate"
                    ]
                },
                {
                    "source_identifier": "wh_db.DimCustomer.effectivedate",
                    "path": [
                        "c.effectivedate"
                    ],
                    "role": "Input for IF"
                }
            ],
            "transformation_type": "EXPRESSION",
            "transformation_logic": "if(a.effectivedate < c.effectivedate, c.effectivedate, a.effectivedate)"
        },
        "enddate": {
            "sources": [
                {
                    "source_identifier": "wh_db_stage.CustomerMgmt.update_ts",
                    "path": [
                        "account.update_ts",
                        "account_final.enddate",
                        "account_cust_updates.enddate",
                        "a.enddate"
                    ]
                },
                {
                    "source_identifier": "wh_db.DimCustomer.enddate",
                    "path": [
                        "c.enddate"
                    ],
                    "role": "Input for IF"
                }
            ],
            "transformation_type": "EXPRESSION",
            "transformation_logic": "if(a.enddate > c.enddate, c.enddate, a.enddate)"
        }
    }
}