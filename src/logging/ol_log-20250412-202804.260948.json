{"eventTime": "2025-04-12T20:28:04.260948", "eventType": "FAIL", "inputs": [{"facets": {}, "name": "customers_final", "namespace": "TPC-DI: duckdb-etl"}, {"facets": {"schema": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/1.29.0/client/python", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/SchemaDatasetFacet", "fields": [{"name": "tx_id", "type": "VARCHAR"}, {"name": "tx_name", "type": "VARCHAR"}, {"name": "tx_rate", "type": "FLOAT"}]}}, "name": "wh_Db.TaxRate", "namespace": "TPC-DI: duckdb-etl"}, {"facets": {"schema": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/1.29.0/client/python", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/SchemaDatasetFacet", "fields": [{"description": "Primary Key: True", "name": "agencyid", "type": "VARCHAR"}, {"description": "Primary Key: True", "name": "lastname", "type": "VARCHAR"}, {"description": "Primary Key: True", "name": "firstname", "type": "VARCHAR"}, {"name": "middleinitial", "type": "VARCHAR"}, {"name": "gender", "type": "VARCHAR"}, {"name": "addressline1", "type": "VARCHAR"}, {"name": "addressline2", "type": "VARCHAR"}, {"name": "postalcode", "type": "VARCHAR"}, {"name": "city", "type": "VARCHAR"}, {"name": "state", "type": "VARCHAR"}, {"name": "country", "type": "VARCHAR"}, {"name": "phone", "type": "VARCHAR"}, {"name": "income", "type": "VARCHAR"}, {"name": "numbercars", "type": "INTEGER"}, {"name": "numberchildren", "type": "INTEGER"}, {"name": "maritalstatus", "type": "VARCHAR"}, {"name": "age", "type": "INTEGER"}, {"name": "creditrating", "type": "INTEGER"}, {"name": "ownorrentflag", "type": "VARCHAR"}, {"name": "employer", "type": "VARCHAR"}, {"name": "numbercreditcards", "type": "INTEGER"}, {"name": "networth", "type": "INTEGER"}, {"name": "marketingnameplate", "type": "VARCHAR"}, {"name": "recordbatchid", "type": "INTEGER"}, {"name": "batchid", "type": "INTEGER"}]}}, "name": "wh_db_stage.ProspectIncremental", "namespace": "TPC-DI: duckdb-etl"}], "job": {"facets": {"sourceCodeLocation": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/1.29.0/client/python", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/SourceCodeLocationJobFacet", "type": "python", "url": "c:\\lopu-kg-test\\project\\src\\main\\main_etl.py"}, "sql": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/1.29.0/client/python", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/SqlJobFacet", "query": "INSERT INTO wh_db.DimCustomer (\n    sk_customerid,\n    customerid,\n    taxid,\n    status,\n    lastname,\n    firstname,\n    middleinitial,\n    gender,\n    tier,\n    dob,\n    addressline1,\n    addressline2,\n    postalcode,\n    city,\n    stateprov,\n    country,\n    phone1,\n    phone2,\n    phone3,\n    email1,\n    email2,\n    nationaltaxratedesc,\n    nationaltaxrate,\n    localtaxratedesc,\n    localtaxrate,\n    agencyid,\n    creditrating,\n    networth,\n    marketingnameplate,\n    iscurrent,\n    batchid,\n    effectivedate,\n    enddate\n)\nWITH MaxSK AS (\n    SELECT COALESCE(MAX(sk_customerid), 0) AS max_sk_customerid\n    FROM wh_db.DimCustomer\n),\nCustomerData AS (\n    SELECT \n        c.customerid,\n        c.taxid,\n        c.status,\n        c.lastname,\n        c.firstname,\n        c.middleinitial,\n        c.gender,\n        c.tier,\n        c.dob,\n        c.addressline1,\n        c.addressline2,\n        c.postalcode,\n        c.city,\n        c.stateprov,\n        c.country,\n        c.phone1,\n        c.phone2,\n        c.phone3,\n        c.email1, \n        c.email2,\n        r_nat.TX_NAME as nationaltaxratedesc,\n        r_nat.TX_RATE as nationaltaxrate,\n        r_lcl.TX_NAME as localtaxratedesc,\n        r_lcl.TX_RATE as localtaxrate,\n        p.agencyid,\n        p.creditrating,\n        p.networth,\n        p.marketingnameplate,\n        c.iscurrent,\n        c.batchid,\n        c.effectivedate,\n        c.enddate \n    FROM customers_final c\n    JOIN wh_db.TaxRate r_lcl \n        ON c.lcl_tx_id = r_lcl.TX_ID\n    JOIN wh_db.TaxRate r_nat \n        ON c.nat_tx_id = r_nat.TX_ID\n    LEFT JOIN wh_db_stage.ProspectIncremental p \n        ON \n            UPPER(p.lastname) = UPPER(c.lastname)\n            AND UPPER(p.firstname) = UPPER(c.firstname)\n            AND UPPER(p.addressline1) = UPPER(c.addressline1)\n            AND UPPER(NULLIF(p.addressline2, '')) = UPPER(NULLIF(c.addressline2, ''))\n            AND UPPER(p.postalcode) = UPPER(c.postalcode)\n    WHERE c.effectivedate < c.enddate\n)\nSELECT \n    ROW_NUMBER() OVER () + (SELECT max_sk_customerid FROM MaxSK) + 1 AS sk_customerid,\n    c.customerid,\n    c.taxid,\n    c.status,\n    c.lastname,\n    c.firstname,\n    c.middleinitial,\n    IF(c.gender IN ('M', 'F'), c.gender, 'U') AS gender,\n    c.tier,\n    c.dob,\n    c.addressline1,\n    c.addressline2,\n    c.postalcode,\n    c.city,\n    c.stateprov,\n    c.country,\n    c.phone1,\n    c.phone2,\n    c.phone3,\n    c.email1, \n    c.email2,\n    nationaltaxratedesc,\n    nationaltaxrate,\n    localtaxratedesc,\n    localtaxrate,\n    agencyid,\n    creditrating,\n    networth,\n    marketingnameplate,\n    iscurrent,\n    batchid,\n    effectivedate,\n    enddate \nFROM CustomerData c;\n "}}, "name": "load_dimcustomer", "namespace": "TPC-DI: duckdb-etl"}, "outputs": [], "producer": "HARDCODED FOR NOW", "run": {"facets": {"errorMessage": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/1.29.0/client/python", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/ErrorMessageRunFacet", "message": "Catalog Error: Table with name customers_final does not exist!\nDid you mean \"wh_db_stage.customers\"?\n\nLINE 74:     FROM customers_final c\n                  ^", "programmingLanguage": "python", "stackTrace": "Traceback (most recent call last):\n  File \"c:\\lopu-kg-test\\project\\src\\main\\lineage_decorator.py\", line 89, in wrapper\n    result = func(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"c:\\lopu-kg-test\\project\\src\\main\\main_etl.py\", line 55, in run_load_dim_customer\n    db_conn.execute(LOAD_BATCH_DATE_SQL)\nduckdb.duckdb.CatalogException: Catalog Error: Table with name customers_final does not exist!\nDid you mean \"wh_db_stage.customers\"?\n\nLINE 74:     FROM customers_final c\n                  ^\n"}}, "runId": "74e21d54-c960-4863-bd45-224c9c4dc409"}, "schemaURL": "https://openlineage.io/spec/1-0-5/OpenLineage.json#/definitions/RunEvent"}
